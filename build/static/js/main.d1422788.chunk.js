(this["webpackJsonpblue-music-share"]=this["webpackJsonpblue-music-share"]||[]).push([[0],{196:function(e,t,n){"use strict";n.r(t);var a,i,r,c,o,s=n(0),u=n.n(s),l=n(20),d=n.n(l),j=n(28),b=n(84),O=n.n(b),g=n(112),p=n(92),h=n(29),m=n(228),x=n(262),f=n(231),v=n(232),y=n(259),S=n(233),w=n(234),N=n(235),C=n(236),I=n(237),q=n(109),k=n.n(q),_=n(110),P=n.n(_),Q=n(93),E=n.n(Q),T=n(48),A=n(73),F=Object(A.a)(a||(a=Object(T.a)(["\n  mutation addOrRemoveFromQueue($input: SongInput!) {\n    addOrRemoveFromQueue(input: $input) @client\n  }\n"]))),G=Object(A.a)(i||(i=Object(T.a)(["\n  mutation addSong(\n    $title: String!\n    $artist: String!\n    $thumbnail: String!\n    $duration: Float!\n    $url: String!\n  ) {\n    insert_songs(\n      objects: {\n        title: $title\n        artist: $artist\n        thumbnail: $thumbnail\n        duration: $duration\n        url: $url\n      }\n    ) {\n      affected_rows\n    }\n  }\n"]))),$=n(69),D=n(6),M=Object(m.a)((function(e){return{container:{display:"flex",alignItems:"center"},urlInput:{margin:e.spacing(1)},addSongButton:{margin:e.spacing(1)},dialog:{textAlign:"center"},thumbnail:{width:"90%"}}})),R={duration:0,title:"",artist:"",thumbnail:""},J=function(){var e=M(),t=Object($.useMutation)(G),n=Object(j.a)(t,2),a=n[0],i=n[1].error,r=Object(s.useState)(),c=Object(j.a)(r,2),o=c[0],u=c[1],l=Object(s.useState)(!1),d=Object(j.a)(l,2),b=d[0],m=d[1],q=Object(s.useState)(!1),_=Object(j.a)(q,2),Q=_[0],T=_[1],A=Object(s.useState)(R),F=Object(j.a)(A,2),J=F[0],B=F[1];Object(s.useEffect)((function(){var e=k.a.canPlay(o)||P.a.canPlay(o);m(e)}),[o]);var L=function(){T(!1)},U=function(e){var t=e.target,n=t.name,a=t.value;B((function(e){return Object(h.a)(Object(h.a)({},e),{},Object(p.a)({},n,a))}))},W=function(){var e=Object(g.a)(O.a.mark((function e(t){var n,a,i;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.player,!(a=n.player.player).getVideoData){e.next=6;break}i=V(a),e.next=10;break;case 6:if(!a.getCurrentSound){e.next=10;break}return e.next=9,z(a);case 9:i=e.sent;case 10:B(Object(h.a)(Object(h.a)({},i),{},{url:o}));case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Y=function(){var e=Object(g.a)(O.a.mark((function e(){var t,n,i,r,c;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t=J.url,n=J.thumbnail,i=J.duration,r=J.title,c=J.artist,e.next=4,a({variables:{url:t.length>0?t:null,thumbnail:n.length>0?n:null,duration:i>0?i:null,title:r.length>0?r:null,artist:c.length>0?c:null}});case 4:L(),B(R),u(""),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),console.error("Error adding song",e.t0);case 12:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(){return e.apply(this,arguments)}}(),V=function(e){var t=e.getDuration(),n=e.getVideoData(),a=n.title,i=n.video_id;return{duration:t,title:a,artist:n.author,thumbnail:"http://img.youtube.com/vi/".concat(i,"/0.jpg")}},z=function(e){return new Promise((function(t){e.getCurrentSound((function(e){e&&t({duration:Number(e.duration/1e3),title:e.title,artist:e.user.username,thumbnail:e.artwork_url.replace("-large","-t500x500")})}))}))},H=function(e){var t,n;return null===i||void 0===i||null===(t=i.graphQLErrors[0])||void 0===t||null===(n=t.extensions)||void 0===n?void 0:n.path.includes(e)},K=J.thumbnail,X=J.title,Z=J.artist;return Object(D.jsxs)("div",{className:e.container,children:[Object(D.jsxs)(x.a,{className:e.dialog,open:Q,onClose:L,children:[Object(D.jsx)(f.a,{children:"Edit Song "}),Object(D.jsxs)(v.a,{children:[Object(D.jsx)("img",{src:K,alt:"Song thumbnail",className:e.thumbnail}),Object(D.jsx)(y.a,{value:X,onChange:U,margin:"dense",name:"title",label:"Title",fullWidth:!0,error:H("title"),helperText:H("title")&&" field required"}),Object(D.jsx)(y.a,{value:Z,onChange:U,margin:"dense",name:"artist",label:"Artist",fullWidth:!0,error:H("artist"),helperText:H("artist")&&" field required"}),Object(D.jsx)(y.a,{value:K,onChange:U,margin:"dense",name:"thumbnail",label:"Thumbnail",fullWidth:!0,error:H("thumbnail"),helperText:H("thumbnail")&&" field required"})]}),Object(D.jsxs)(S.a,{children:[Object(D.jsx)(w.a,{onClick:L,color:"secondary",children:"Cancel"}),Object(D.jsx)(w.a,{onClick:Y,color:"primary",variant:"outlined",children:"Add Song"})]})]}),Object(D.jsx)(y.a,{className:e.urlInput,onChange:function(e){return u(e.target.value)},value:o,placeholder:"Add Youtube or Soundcloud Url \ud83d\ude0e ",fullWidth:!0,margin:"normal",type:"url",InputProps:{startAdornment:Object(D.jsx)(N.a,{position:"start",children:Object(D.jsx)(C.a,{})})}}),Object(D.jsx)(w.a,{disabled:!b,className:e.addSongButton,onClick:function(){return T(!0)},variant:"contained",color:"primary",endIcon:Object(D.jsx)(I.a,{}),children:"Add"}),Object(D.jsx)(E.a,{url:o,hidden:!0,onReady:W})]})},B=n(238),L=n(239),U=n(116),W=n(240),Y=Object(m.a)((function(e){return{title:{marginLeft:e.spacing(2)}}})),V=function(){var e=Y();return Object(D.jsx)(B.a,{color:"primary",position:"fixed",children:Object(D.jsxs)(L.a,{children:[Object(D.jsx)(W.a,{}),Object(D.jsx)(U.a,{className:e.title,variant:"h6",component:"h1",children:"Blue Music Share"})]})})},z=n(241),H=n(263),K=n(242),X=n(243),Z=function(e){var t=e.queue;console.log({queue:t});var n=Object(z.a)((function(e){return e.breakpoints.up("md")})),a=Object(m.a)({avatar:{width:44,height:44},text:{textOverflow:"ellipsis",overflow:"hidden"},container:{display:"grid",gridAutoFlow:"column",gridTemplateColumns:"50px auto 50px",gridGap:12,alignItems:"center",marginTop:10},songInfoContainer:{overflow:"hidden",whiteSpace:"nowrap"}}),i=function(e){var t=e.song,n=a(),i=Object($.useMutation)(F,{onCompleted:function(e){localStorage.setItem("queue",JSON.stringify(e.addOrRemoveFromQueue))}}),r=Object(j.a)(i,1)[0],c=t.thumbnail,o=t.artist,s=t.title;return Object(D.jsxs)("div",{className:n.container,children:[Object(D.jsx)(H.a,{className:n.avatar,src:c,alt:"song thumbnail"}),Object(D.jsxs)("div",{className:n.songInfoContainer,children:[Object(D.jsx)(U.a,{className:n.text,variant:"subtitle2",children:s}),Object(D.jsx)(U.a,{className:n.text,color:"textSecondary",variant:"body2",children:o})]}),Object(D.jsx)(K.a,{onClick:function(){r({variables:{input:Object(h.a)(Object(h.a)({},t),{},{__typename:"Song"})}})},children:Object(D.jsx)(X.a,{color:"error"})})]})};return n&&Object(D.jsxs)("div",{style:{margin:"10px 0"},children:[Object(D.jsxs)(U.a,{color:"textSecondary",variant:"button",children:["Upcoming Songs (",t.length,")"]}),t.map((function(e,t){return Object(D.jsx)(i,{song:e},t)}))]})},ee=n(244),te=n(245),ne=n(246),ae=n(247),ie=n(248),re=n(249),ce=n(250),oe=n(251),se=Object(A.a)(r||(r=Object(T.a)(["\n  subscription getSongs {\n    songs(order_by: { created_at: desc }) {\n      artist\n      duration\n      id\n      thumbnail\n      title\n      url\n    }\n  }\n"]))),ue=function(){var e=Object($.useSubscription)(se),t=e.data,n=e.loading,a=e.error;if(n)return Object(D.jsx)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",marginTop:50},children:Object(D.jsx)(ee.a,{})});if(a)return Object(D.jsx)("div",{children:"Error getting songs"});var i=Object(m.a)((function(e){return{container:{margin:e.spacing(3)},songInfoContainer:{display:"flex",alignItems:"center"},songInfo:{width:"100%",display:"flex",justifyContent:"space-between"},thumbnail:{objectFit:"cover",width:140,height:140}}})),r=function(e){var t=e.song,n=t.id,a=i(),r=Object($.useMutation)(F,{onCompleted:function(e){localStorage.setItem("queue",JSON.stringify(e.addOrRemoveFromQueue))}}),c=Object(j.a)(r,1)[0],o=t.thumbnail,u=t.title,l=t.artist,d=Object(s.useContext)(xe),b=d.state,O=d.dispatch,g=Object(s.useState)(!1),p=Object(j.a)(g,2),m=p[0],x=p[1];Object(s.useEffect)((function(){var e=b.isPlaying&&n===b.song.id;x(e)}),[n,b.song.id,b.isPlaying]);return Object(D.jsx)(te.a,{className:a.container,children:Object(D.jsxs)("div",{className:a.songInfoContainer,children:[Object(D.jsx)(ne.a,{className:a.thumbnail,image:o}),Object(D.jsxs)("div",{className:a.songInfo,children:[Object(D.jsxs)(ae.a,{children:[Object(D.jsx)(U.a,{gutterBottom:!0,variant:"h5",component:"h2",children:u}),Object(D.jsx)(U.a,{variant:"body5",component:"p",color:"textSecondary",children:l})]}),Object(D.jsxs)(ie.a,{children:[Object(D.jsx)(K.a,{onClick:function(){O({type:"SET_SONG",payload:{song:t}}),O(b.isPlaying?{type:"PAUSE_SONG"}:{type:"PLAY_SONG"})},size:"small",color:"primary",children:m?Object(D.jsx)(re.a,{}):Object(D.jsx)(ce.a,{})}),Object(D.jsx)(K.a,{onClick:function(){c({variables:{input:Object(h.a)(Object(h.a)({},t),{},{__typename:"Song"})}})},size:"small",color:"secondary",children:Object(D.jsx)(oe.a,{})})]})]})]})})};return Object(D.jsx)("div",{children:t.songs.map((function(e){return Object(D.jsx)(r,{song:e},e.id)}))})},le=n(264),de=n(252),je=n(253),be=(Object(A.a)(c||(c=Object(T.a)(["\n  query getSongs {\n    songs(order_by: { created_at: desc }) {\n      artist\n      duration\n      id\n      thumbnail\n      title\n      url\n    }\n  }\n"]))),Object(A.a)(o||(o=Object(T.a)(["\n  query getQueuedSongs {\n    queue @client {\n      id\n      duration\n      title\n      artist\n      thumbnail\n      url\n    }\n  }\n"])))),Oe=Object(m.a)((function(e){return{container:{display:"flex",justifyContent:"space-between"},details:{display:"flex",flexDirection:"column",padding:"0px 15px"},content:{flex:"1 0 auto"},thumbnail:{width:150},controls:{display:"flex",alignItems:"center",paddingLeft:e.spacing(1),paddingRight:e.spacing(1)},playIcon:{height:38,width:38}}})),ge=function(){var e=Object($.useQuery)(be).data,t=Object(s.useRef)(),n=Object(s.useContext)(xe),a=n.state,i=n.dispatch,r=Object(s.useState)(0),c=Object(j.a)(r,2),o=c[0],u=c[1],l=Object(s.useState)(0),d=Object(j.a)(l,2),b=d[0],O=d[1],g=Object(s.useState)(!1),p=Object(j.a)(g,2),h=p[0],m=p[1],x=Oe(),f=Object(s.useState)(0),v=Object(j.a)(f,2),y=v[0],S=v[1];Object(s.useEffect)((function(){var t=e.queue.findIndex((function(e){return e.id===a.song.id}));S(t)}),[e.queue,a.song.id]),Object(s.useEffect)((function(){var t=e.queue[y+1];o>=.99&&t&&(u(0),i({type:"SET_SONG",payload:{song:t}}))}),[e.queue,o,i,y]);var w;return Object(D.jsxs)(D.Fragment,{children:[Object(D.jsxs)(te.a,{className:x.container,variant:"outlined",children:[Object(D.jsxs)("div",{className:x.details,children:[Object(D.jsxs)(ae.a,{className:x.content,children:[Object(D.jsx)(U.a,{variant:"h5",component:"h3",children:a.song.title}),Object(D.jsx)(U.a,{variant:"subtitle1",component:"p",color:"textSecondary",children:a.song.artist})]}),Object(D.jsxs)("div",{className:x.controls,children:[Object(D.jsx)(K.a,{onClick:function(){var t=e.queue[y-1];t&&i({type:"SET_SONG",payload:{song:t}})},children:Object(D.jsx)(de.a,{})}),Object(D.jsx)(K.a,{onClick:function(){i(a.isPlaying?{type:"PAUSE_SONG"}:{type:"PLAY_SONG"})},children:a.isPlaying?Object(D.jsx)(re.a,{className:x.playIcon}):Object(D.jsx)(ce.a,{className:x.playIcon})}),Object(D.jsx)(K.a,{onClick:function(){var t=e.queue[y+1];t&&i({type:"SET_SONG",payload:{song:t}})},children:Object(D.jsx)(je.a,{})}),Object(D.jsx)(U.a,{variant:"subtitle1",component:"p",color:"textSecondary",children:(w=b,new Date(1e3*w).toISOString().substr(11,8))})]}),Object(D.jsx)(le.a,{onMouseDown:function(){m(!0)},onMouseUp:function(){m(!1),t.current.seekTo(o)},onChange:function(e,t){u(t)},value:o,type:"range",min:0,max:1,step:.01})]}),Object(D.jsx)(E.a,{ref:t,onProgress:function(e){var t=e.played,n=e.playedSeconds;h||(u(t),O(n))},hidden:!0,url:a.song.url,playing:a.isPlaying}),Object(D.jsx)(ne.a,{className:x.thumbnail,image:a.song.thumbnail})]}),Object(D.jsx)(Z,{queue:e.queue})]})},pe=n(261),he=n(254);var me=function(e,t){switch(t.type){case"PLAY_SONG":return Object(h.a)(Object(h.a)({},e),{},{isPlaying:!0});case"PAUSE_SONG":return Object(h.a)(Object(h.a)({},e),{},{isPlaying:!1});case"SET_SONG":return Object(h.a)(Object(h.a)({},e),{},{song:t.payload.song});default:return e}},xe=u.a.createContext({song:{id:"8f551863-5eda-45d1-9d94-3538cd678470",title:"Davido - Jowo (Official Video)",artist:"Davido",thumbnail:"http://img.youtube.com/vi/l6QMJniQWxQ/0.jpg",url:"https://www.youtube.com/watch?v=l6QMJniQWxQ",duration:177},isPlaying:!1});var fe,ve=function(){var e=Object(s.useContext)(xe),t=Object(s.useReducer)(me,e),n=Object(j.a)(t,2),a=n[0],i=n[1],r=Object(z.a)((function(e){return e.breakpoints.up("md")})),c=Object(z.a)((function(e){return e.breakpoints.up("sm")}));return Object(D.jsxs)(xe.Provider,{value:{state:a,dispatch:i},children:[Object(D.jsx)(pe.a,{only:"xs",children:Object(D.jsx)(V,{})}),Object(D.jsxs)(he.a,{container:!0,spacing:3,children:[Object(D.jsxs)(he.a,{style:{paddingTop:c?80:10},item:!0,xs:12,md:7,children:[Object(D.jsx)(J,{}),Object(D.jsx)(ue,{})]}),Object(D.jsx)(he.a,{style:r?{position:"fixed",width:"100%",right:0,top:70}:{position:"fixed",width:"100%",left:0,bottom:0},item:!0,xs:12,md:5,children:Object(D.jsx)(ge,{})})]})]})},ye=n(257),Se=n(258),we=n(145),Ne=n(255),Ce=n(256),Ie=Object(we.a)({palette:{type:"dark",primary:Ne.a,secondary:Ce.a}}),qe=n(146),ke=n(143),_e=n(148),Pe=n(147),Qe=new ke.a({link:new _e.a({uri:"wss://blue-music-share.herokuapp.com/v1/graphql",options:{reconnect:!0}}),cache:new Pe.a,typeDefs:Object(A.a)(fe||(fe=Object(T.a)(["\n    type Song {\n      id: uuid!\n      title: String!\n      artist: String!\n      thumbnail: String!\n      duration: Float!\n      url: String!\n    }\n\n    input SongInput {\n      id: uuid!\n      title: String!\n      artist: String!\n      thumbnail: String!\n      duration: Float!\n      url: String!\n    }\n\n    type Query {\n      queue: [Song]!\n    }\n\n    type Mutation {\n      addOrRemoveFromQueue(input: SongInput!): [Song]!\n    }\n  "]))),resolvers:{Mutation:{addOrRemoveFromQueue:function(e,t,n){var a=t.input,i=n.cache,r=i.readQuery({query:be});if(r){var c=r.queue,o=c.some((function(e){return e.id===a.id}))?c.filter((function(e){return e.id!==a.id})):[].concat(Object(qe.a)(c),[a]);return i.writeQuery({query:be,data:{queue:o}}),o}return[]}}}}),Ee={queue:Boolean(localStorage.getItem("queue"))?JSON.parse(localStorage.getItem("queue")):[]};Qe.writeData({data:Ee});var Te=Qe;d.a.render(Object(D.jsx)(u.a.StrictMode,{children:Object(D.jsx)($.ApolloProvider,{client:Te,children:Object(D.jsxs)(ye.a,{theme:Ie,children:[Object(D.jsx)(Se.a,{}),Object(D.jsx)(ve,{})]})})}),document.getElementById("root"))}},[[196,1,2]]]);
//# sourceMappingURL=main.d1422788.chunk.js.map